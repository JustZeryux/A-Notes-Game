<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A NOTES GAME: V82</title>
    
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="notification-area"></div>
    <div id="chat-dock"></div> 

    <div id="bg-layer"><img id="bg-image"></div>

    <div id="menu-container">
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-icon"></div>
                <div>A NOTES<br>GAME</div>
            </div>
            
            <div class="user-card" onclick="openModal('profile')">
                <div class="u-avatar" id="m-av">G</div>
                <div class="u-info">
                    <div id="m-name">Guest</div>
                    <div id="m-rank">LVL 1</div>
                </div>
            </div>

            <div class="nav-section">
                <button class="nav-btn active" id="btn-songs" onclick="switchSection('songs')">üéµ CANCIONES</button>
                <button class="nav-btn" id="btn-hosts" onclick="switchSection('hosts')">‚öîÔ∏è SALAS / HOSTS</button>
                <button class="nav-btn" id="btn-store" onclick="switchSection('store')">üõí TIENDA</button>
                <button class="nav-btn" onclick="openFriends()">üë• AMIGOS</button>
                <button class="nav-btn" onclick="openModal('settings')">‚öôÔ∏è AJUSTES</button>
                <button class="nav-btn" onclick="openLeaderboard()">üåê RANKING</button>
            </div>

            <label class="import-btn" id="imp-btn">
                <span id="imp-txt">üìÇ IMPORTAR MP3</span>
                <input type="file" id="imp-input" accept="audio/*" style="display:none" onchange="handleAudio(this)" onclick="this.value=null">
            </label>
            <button class="news-btn" onclick="openModal('news')">üì∞ NOVEDADES</button>
        </aside>

        <main class="content-area">
            <div id="sec-songs" class="section-view active">
                <div class="top-bar">
                    <input type="text" class="search-inp" placeholder="Buscar canci√≥n..." oninput="renderMenu(this.value)">
                    <div style="font-weight:900; color:#aaa; display:flex; gap:20px;">
                        <span>SP: <span id="h-sp" style="color:var(--gold);">0</span></span>
                        <span>PP: <span id="h-pp" style="color:var(--blue);">0</span></span>
                    </div>
                </div>
                <div class="song-grid" id="song-grid"></div>
            </div>

            <div id="sec-hosts" class="section-view">
                <div class="top-bar" style="justify-content:flex-end;">
                    <button class="action" style="width:200px; margin:0;" onclick="createHost()">+ CREAR SALA</button>
                </div>
                <div class="host-list" id="host-list-container">
                    <div style="color:#666; text-align:center; padding-top:20px;">Cargando salas...</div>
                </div>
            </div>

            <div id="sec-store" class="section-view">
                <div class="top-bar"><h1 style="color:var(--gold); margin:0;">TIENDA</h1></div>
                <div class="store-grid">
                    <div class="store-item">
                        <h3 style="color:white;">SKIN: NEON</h3>
                        <p style="color:var(--gold);">1000 SP</p>
                        <button class="action secondary">COMPRAR</button>
                    </div>
                    </div>
            </div>
        </main>
    </div>

    <div id="game-layer">
        <div id="vs-hud">
            <div class="vs-panel">
                <div class="vs-name" id="p1-name">YOU</div>
                <div class="vs-score" id="p1-score">0</div>
            </div>
            <div style="font-size:2rem; font-weight:900; font-style:italic; color:var(--accent)">VS</div>
            <div class="vs-panel" style="border-color:var(--miss)">
                <div class="vs-name" id="p2-name" style="color:var(--miss)">OPPONENT</div>
                <div class="vs-score" id="p2-score">0</div>
            </div>
        </div>

        <div id="ig-profile">
            <div id="ig-av"></div>
            <div id="ig-name" style="color:white;">User</div>
        </div>

        <div id="track"></div>

        <div id="hud">
            <div class="stats-col">
                <div class="score-val" id="g-score">0</div>
                <div class="acc-val" id="g-acc">100%</div>
            </div>
            <div class="health-bar"><div class="health-fill" id="health-fill"></div></div>
        </div>
        <div id="countdown" style="position:absolute; width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:15rem; font-weight:900; z-index:600; color:white;"></div>
    </div>

    <div id="modal-friends" class="modal-overlay">
        <div class="modal-panel" style="width:600px;">
            <div class="m-title">SOCIAL HUB</div>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <input type="text" id="friend-inp" class="log-inp" placeholder="Nombre exacto..." style="margin:0;">
                <button class="action" style="margin:0; width:120px;" onclick="sendFriendRequest()">AGREGAR</button>
            </div>
            <div id="req-list" class="friend-list" style="margin-bottom:20px;"></div>
            <div style="color:#aaa; font-weight:bold; margin-bottom:10px; text-align:left;">AMIGOS</div>
            <div id="friend-list" class="friend-list"></div>
            <button class="action secondary" onclick="closeModal('friends')">CERRAR</button>
        </div>
    </div>

    <div id="modal-friend-profile" class="modal-overlay">
        <div class="modal-panel" style="width:500px;">
            <div id="fp-av" style="width:120px; height:120px; border-radius:50%; margin:0 auto 20px; background:#333; background-size:cover; border:4px solid var(--accent);"></div>
            <h2 id="fp-name" style="font-size:2rem; font-weight:900; margin-bottom:5px; color:white;">User</h2>
            <div id="fp-lvl" style="color:var(--accent); font-weight:900; margin-bottom:15px;">LVL 1</div>
            
            <div id="fp-stats" style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin:20px 0;">
                <div class="fp-stat-box" style="background:#151515; padding:15px; border-radius:10px;">PP <br><span id="fp-pp" style="color:var(--blue); font-size:1.5rem;">0</span></div>
                <div class="fp-stat-box" style="background:#151515; padding:15px; border-radius:10px;">JUGADAS <br><span id="fp-plays" style="color:white; font-size:1.5rem;">0</span></div>
            </div>
            
            <div id="fp-status-text" style="color:#888; font-style:italic; margin-bottom:15px;">Desconectado</div>
            
            <div class="fp-actions" style="display:flex; gap:10px;">
                <button class="action btn-chat" style="background:var(--gold); color:black;" onclick="openChatWithFriend()">üí¨ CHATEAR</button>
                <button id="btn-challenge" class="action btn-add" style="background:var(--blue); color:black;" disabled>‚öîÔ∏è DESAFIAR</button>
            </div>
            <button class="action secondary" onclick="closeModal('friend-profile')">CERRAR</button>
        </div>
    </div>

    <div id="modal-lobby" class="modal-overlay">
        <div class="modal-panel" style="width:900px;">
            <div class="m-title" id="lobby-title">SALA DE JUEGO</div>
            
            <h3 id="lobby-song-name" style="color:var(--accent); font-size:1.5rem; margin-bottom:20px;">Seleccionando...</h3>
            
            <div class="room-players" id="lobby-players"></div>

            <div style="margin-top:30px;">
                <button id="btn-ready" class="btn-ready" onclick="toggleReady()">NO LISTO</button>
            </div>
            <button class="action secondary" onclick="leaveLobby()" style="margin-top:20px;">SALIR DE LA SALA</button>
        </div>
    </div>

    <div id="modal-online" class="modal-overlay">
        <div class="modal-panel" style="width:700px;">
            <div class="m-title">ONLINE LOBBY</div>
            <div style="color:var(--accent); font-weight:900; margin-bottom:15px;">CONECTADO CON: <span id="lobby-opp-name">...</span></div>
            
            <div class="lobby-box">
                <div class="lobby-slot">
                    <div class="slot-title">TU ELECCI√ìN</div>
                    <div class="slot-song" id="my-pick-name">...</div>
                    <div class="slot-status" id="my-pick-status">Esperando...</div>
                    <button class="btn-small btn-add" style="margin-top:10px; width:100%; padding:10px;" onclick="document.getElementById('online-file').click()">ELEGIR</button>
                    <input type="file" id="online-file" accept="audio/*" style="display:none" onchange="handleOnlineFile(this)">
                </div>
                <div class="lobby-slot">
                    <div class="slot-title">RIVAL</div>
                    <div class="slot-song" id="opp-pick-name">...</div>
                    <div class="slot-status" id="opp-pick-status">Esperando...</div>
                </div>
            </div>

            <div id="chat-ui-container" style="text-align:left; margin-top:20px;">
                <div style="color:var(--blue); font-weight:bold; margin-bottom:5px;">CHAT</div>
                <div id="chat-box"></div>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="chat-inp" class="log-inp" placeholder="Escribe..." style="margin:0; padding:10px; font-size:0.9rem;">
                    <button class="btn-small btn-add" onclick="sendChat()">ENVIAR</button>
                </div>
            </div>

            <div id="roulette-msg" style="text-align:center; font-size:1.5rem; font-weight:900; color:var(--gold); margin-top:15px;"></div>
            <button class="action secondary" onclick="closeModal('online')" style="margin-top:20px;">SALIR</button>
        </div>
    </div>

    <div id="modal-profile" class="modal-overlay">
        <div class="modal-panel login-box">
            <div id="login-view">
                <div class="m-title">ACCESO</div>
                <button class="action" onclick="loginGoogle()" style="background:#4285F4; color:white; margin-bottom:20px;">G - ENTRAR CON GOOGLE</button>
                <div style="margin:20px; color:#666;">- O -</div>
                <input type="text" id="l-user" class="log-inp" placeholder="Usuario">
                <input type="password" id="l-pass" class="log-inp" placeholder="Contrase√±a">
                <button class="action" onclick="login()">ENTRAR</button>
                <button class="action secondary" onclick="register()">REGISTRAR</button>
            </div>
            <div id="profile-view" style="display:none;">
                <div class="m-title">TU CUENTA</div>
                
                <div class="settings-tabs">
                    <div class="kb-tab active" id="ptab-resumen" onclick="switchProfileTab('resumen')">RESUMEN</div>
                    <div class="kb-tab" id="ptab-cuenta" onclick="switchProfileTab('cuenta')">CUENTA</div>
                </div>

                <div id="p-tab-content-resumen">
                    <label class="prof-av-big" id="p-av-big">
                        <input type="file" accept="image/*" style="display:none" onchange="uploadAvatar(this)" onclick="this.value=null">
                    </label>
                    <h2 id="p-name" style="margin:0;">User</h2>
                    <div id="p-lvl-txt" style="color:var(--accent); font-weight:900;">LVL 1</div>
                    <div class="xp-container"><div class="xp-fill" id="p-xp-bar"></div></div>
                    <div class="xp-text" id="p-xp-txt">0 / 1000 XP</div>
                    <div style="color:var(--blue); font-weight:bold; margin:20px 0;">GLOBAL RANK: <span id="p-global-rank">#--</span></div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:30px;">
                        <div style="background:#151515; padding:20px; border-radius:12px;">SCORE<br><span id="p-score">0</span></div>
                        <div style="background:#151515; padding:20px; border-radius:12px;">JUGADAS<br><span id="p-plays">0</span></div>
                    </div>
                </div>

                <div id="p-tab-content-cuenta" style="display:none;">
                    <div id="local-acc-settings">
                        <div style="color:#aaa; margin-bottom:15px;">Cambiar Contrase√±a</div>
                        <input type="password" id="new-pass" class="log-inp" placeholder="Nueva contrase√±a">
                        <button class="action secondary" onclick="changePassword()">ACTUALIZAR</button>
                    </div>
                    <div id="google-acc-settings" style="display:none; color:#aaa; margin-top:20px;">
                        Gestiona tu seguridad en Google.
                    </div>
                    <button class="action secondary" onclick="logout()" style="border-color:var(--miss); color:var(--miss); margin-top:30px;">CERRAR SESI√ìN</button>
                </div>
            </div>
            <button class="action secondary" style="margin-top:20px;" onclick="closeModal('profile')">CERRAR</button>
        </div>
    </div>

    <div id="modal-settings" class="modal-overlay">
        <div class="modal-panel">
            <div class="m-title">CONFIGURACI√ìN</div>
            <div class="set-grid">
                <div>
                    <div class="set-head">GENERAL</div>
                    <div class="set-row"><span>Velocidad</span><input type="range" id="set-spd" min="10" max="40"></div>
                    <div class="set-row"><span>Dificultad</span><input type="range" id="set-den" min="1" max="10"></div>
                    <div class="set-row"><span>Volumen</span><input type="range" id="set-vol" min="0" max="100"></div>
                    <div class="set-row"><span>Downscroll</span><input type="checkbox" id="set-down"></div>
                    <div class="set-row"><span>Efectos</span><input type="checkbox" id="set-vivid"></div>
                    <div class="set-row"><span>Shake</span><input type="checkbox" id="set-shake"></div>
                    <div class="set-row"><span>Offset</span><input type="number" id="set-off" style="width:70px;background:#111;color:white;border:1px solid #333;"></div>
                    <div class="set-head" style="margin-top:20px;">HUD</div>
                    <div class="set-row"><span>Pos Juez Y</span><input type="range" id="set-judge-y" min="10" max="90"></div>
                    <div class="set-row"><span>Pos Juez X</span><input type="range" id="set-judge-x" min="10" max="90"></div>
                    <div class="set-row"><span>Tam Juez</span><input type="range" id="set-judge-s" min="5" max="20"></div>
                    <div class="set-row"><span>Ver Juez</span><input type="checkbox" id="set-judge-vis"></div>
                    <button class="action secondary" style="margin-top:15px;" onclick="document.getElementById('bg-file').click()">üñºÔ∏è FONDO</button>
                    <input type="file" id="bg-file" accept="image/*" style="display:none" onchange="handleBg(this)">
                </div>
                <div>
                    <div class="set-head">CONTROLES</div>
                    <div class="kb-tabs">
                        <div class="kb-tab active" id="tab-4" onclick="renderLaneConfig(4)">4K</div>
                        <div class="kb-tab" id="tab-6" onclick="renderLaneConfig(6)">6K</div>
                        <div class="kb-tab" id="tab-7" onclick="renderLaneConfig(7)">7K</div>
                        <div class="kb-tab" id="tab-9" onclick="renderLaneConfig(9)">9K</div>
                    </div>
                    <div class="lane-cfg-box"><div id="lanes-container" class="lanes-view"></div></div>
                    <button class="action secondary" style="margin-top:30px;" onclick="document.getElementById('hit-file').click()">üîä HIT SOUND</button>
                    <input type="file" id="hit-file" accept="audio/*" style="display:none" onchange="loadHitSound(this)">
                </div>
            </div>
            <button class="action" onclick="saveSettings()">GUARDAR</button>
        </div>
    </div>

    <div id="modal-rank" class="modal-overlay">
        <div class="modal-panel">
            <div class="m-title">RANKING GLOBAL</div>
            <table class="rank-table">
                <thead><tr><th>#</th><th>JUGADOR</th><th>PP</th></tr></thead>
                <tbody id="rank-list"></tbody>
            </table>
            <button class="action secondary" style="margin-top:30px;" onclick="closeModal('rank')">CERRAR</button>
        </div>
    </div>

    <div id="modal-news" class="modal-overlay">
        <div class="modal-panel" style="width:600px;">
            <div class="m-title">NOVEDADES</div>
            <p>Econom√≠a SP, Salas P√∫blicas, Chat Flotante y Arreglos Sociales.</p>
            <button class="action secondary" onclick="closeModal('news')">CERRAR</button>
        </div>
    </div>

    <div id="modal-diff" class="modal-overlay">
        <div class="modal-panel" style="width:850px;">
            <div class="m-title">MODO</div>
            <div class="diff-grid">
                <div class="diff-card" onclick="startGame(4)" style="color:#00FFFF"><div style="font-size:3rem;font-weight:900">4K</div>NORMAL</div>
                <div class="diff-card" onclick="startGame(6)" style="color:#12FA05"><div style="font-size:3rem;font-weight:900">6K</div>HARD</div>
                <div class="diff-card" onclick="startGame(7)" style="color:#FFD700"><div style="font-size:3rem;font-weight:900">7K</div>INSANE</div>
                <div class="diff-card" onclick="startGame(9)" style="color:#F9393F"><div style="font-size:3rem;font-weight:900">9K</div>DEMON</div>
            </div>
            <div class="ranked-toggle">
                <input type="checkbox" id="chk-ranked"> <label for="chk-ranked" style="margin-left:10px; color:var(--accent);">RANKED</label>
            </div>
            <button class="action secondary" style="margin-top:20px;" onclick="closeModal('diff')">CANCELAR</button>
        </div>
    </div>

    <div id="modal-pause" class="modal-overlay">
        <div class="modal-panel login-box">
            <div class="m-title">PAUSA</div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; font-size:1.3rem; margin-bottom:30px;">
                <div style="color:var(--sick)">SICK: <span id="p-sick">0</span></div>
                <div style="color:var(--good)">GOOD: <span id="p-good">0</span></div>
                <div style="color:var(--bad)">BAD: <span id="p-bad">0</span></div>
                <div style="color:var(--miss)">MISS: <span id="p-miss">0</span></div>
            </div>
            <button class="action" onclick="resumeGame()">CONTINUAR</button>
            <button class="action secondary" onclick="toMenu()">SALIR</button>
        </div>
    </div>

    <div id="modal-res" class="modal-overlay">
        <div class="modal-panel login-box" style="width:600px;">
            <div class="m-title">RESULTADOS</div>
            <div class="res-rank" id="res-rank">S</div>
            <div id="winner-msg" style="font-size:2rem; font-weight:900; display:none; margin-bottom:20px;"></div>
            <div style="font-size:4rem; font-weight:900;" id="res-score">0</div>
            <div style="color:#aaa; font-size:1.5rem;">ACC: <span id="res-acc" style="color:white; font-weight:bold;">100%</span></div>
            <div id="pp-gain-loss" style="color:var(--gold); font-weight:bold; font-size:1.2rem; margin-top:15px;">+0 PP</div>
            <div style="color:var(--blue); font-weight:bold; font-size:1rem; margin-top:5px;">+<span id="res-xp">0</span> XP</div>
            <button class="action" onclick="toMenu()">VOLVER</button>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/db.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/social.js"></script>
    <script src="js/multiplayer.js"></script>
    <script src="js/engine.js"></script>
    <script src="js/main.js"></script>

</body>
</html>
