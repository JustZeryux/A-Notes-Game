<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Notes Game</title>
    <meta name="title" content="A Notes Game">
    <meta name="description" content="El mejor juego de ritmo en tu navegador. Juega mapas creados por la comunidad, personaliza tus teclas, sube de nivel y compite en el ranking global online.">
    <meta name="theme-color" content="#ff66aa">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://a-notes-game.pages.dev/">
    <meta property="og:title" content="A Notes Game - Juego de Ritmo">
    <meta property="og:description" content="Compite online, sube tus propias canciones y convi√©rtete en el mejor jugador.">
    <meta property="og:image" content="https://a-notes-game.pages.dev/icon.png">
    <meta property="og:site_name" content="A Notes Game">
    
    <link rel="icon" type="image/png" href="icon.png">
    
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="notification-area"></div>
    <div id="chat-overlay-container"></div>
    
    <div id="loading-overlay" style="display:none;">
        <div class="loader"></div>
        <div id="loading-text">Cargando...</div>
    </div>

    <div id="editor-layer" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#0a0a0a; z-index:9000; color:white; flex-direction:column;">
        <div style="height: 60px; background: #111; border-bottom: 2px solid var(--accent); display: flex; justify-content: space-between; align-items: center; padding: 0 20px;">
            <div style="display:flex; gap:15px; align-items:center;">
                <button class="action secondary" style="width:auto; padding:5px 15px;" onclick="closeEditor()">SALIR</button>
                <div id="ed-title" style="font-weight:bold; font-size:1.2rem;">Editor Mode</div>
            </div>
            <audio id="ed-audio" controls style="height: 40px; outline:none;"></audio>
            <button class="action btn-acc" style="width:auto; padding:5px 20px;" onclick="saveEditorMap()">üíæ GUARDAR MAPA</button>
        </div>
        <div style="flex:1; display:flex; overflow:hidden;">
            <div style="width:250px; background:#111; border-right:1px solid #333; padding:20px; display:flex; flex-direction:column; gap:20px;">
                <div style="color:var(--gold); font-weight:bold;">üõ†Ô∏è HERRAMIENTAS</div>
                <div>
                    <div style="margin-bottom:5px; font-size:0.9rem;">ZOOM (L√≠nea de tiempo)</div>
                    <input type="range" id="ed-zoom" min="10" max="100" value="30" style="width:100%;" oninput="drawEditorGrid()">
                </div>
                <div style="background:#222; padding:10px; border-radius:8px; font-size:0.8rem; color:#aaa;">
                    <b>Controles:</b><br>
                    - Clic en la pista: Poner Nota<br>
                    - Clic en nota: Borrar Nota<br>
                    - Barra Espaciadora: Play/Pausa
                </div>
                <button class="action secondary" onclick="clearEditorMap()" style="border-color:#F9393F; color:#F9393F; margin-top:auto;">üóëÔ∏è BORRAR TODO</button>
            </div>
            <div id="ed-scroll-area" style="flex:1; background:#1a1a1a; overflow-y:scroll; position:relative; display:flex; justify-content:center;">
                <div id="ed-grid" style="position:relative; width:400px; background:#000; border-left:2px solid #444; border-right:2px solid #444; cursor:crosshair;"></div>
                <div id="ed-playhead" style="position:absolute; width:400px; height:2px; background:red; z-index:100; pointer-events:none; top:0; box-shadow: 0 0 10px red;"></div>
            </div>
        </div>
    </div>
    
    <div id="bg-layer">
        <video id="bg-video" loop muted playsinline style="display:none;"></video>
        <img id="bg-image">
    </div>

    <div id="menu-container">
        <aside class="sidebar">
            <div class="brand">
                <img src="icon.png" alt="A Notes Game Logo" style="width: 50px; height: 50px; border-radius: 50%; box-shadow: 0 0 20px var(--accent); flex-shrink: 0; margin-right: 15px;">
                A Notes Game
            </div>
            
            <div class="user-card" onclick="openModal('profile')" onmouseenter="if(typeof playHover==='function') playHover()">
                <div class="u-avatar" id="m-av">G</div>
                <div class="u-info">
                    <div id="m-name">Guest</div>
                    <div id="m-rank">LVL 1</div>
                </div>
            </div>
            <button class="nav-btn" id="nav-osu" onmouseenter="if(typeof playHover==='function') playHover()" onclick="openOsuBrowser()" style="color: #ff66aa; border-color: #ff66aa;">üå∏ OSU! DIRECT</button>
            <div class="nav-section">
                <button class="nav-btn active" id="nav-songs" onmouseenter="if(typeof playHover==='function') playHover()" onclick="changeSection('songs')">üéµ CANCIONES GLOBALES</button>
                <button class="nav-btn" id="nav-multi" onmouseenter="if(typeof playHover==='function') playHover()" onclick="openLobbyBrowser()">‚öîÔ∏è SALAS ONLINE</button>
                <button class="nav-btn" id="nav-shop" onmouseenter="if(typeof playHover==='function') playHover()" onclick="openShop()">üõí TIENDA</button>
                <button class="nav-btn" id="nav-settings" onmouseenter="if(typeof playHover==='function') playHover()" onclick="openModal('settings')">‚öôÔ∏è AJUSTES</button>
                <button class="nav-btn" id="nav-rank" onmouseenter="if(typeof playHover==='function') playHover()" onclick="openLeaderboard()">üåê RANKING</button>
                <button class="nav-btn" id="nav-friends" onmouseenter="if(typeof playHover==='function') playHover()" onclick="openFriends()">üë• AMIGOS</button>
    
                <button class="nav-btn" onclick="openStudioDashboard()" style="color: #00ffff; border-left: 3px solid #00ffff; background: rgba(0, 255, 255, 0.05);">
                    ‚úèÔ∏è CREATOR STUDIO
                </button>

                <button class="import-btn" id="imp-btn" onmouseenter="if(typeof playHover==='function') playHover()" onclick="openCustomUploadModal()">
                    <span id="imp-txt">‚òÅÔ∏è SUBIR CANCI√ìN</span>
                </button>
                <button class="news-btn" onclick="openModal('news')">üì∞ NOVEDADES</button>
            </div>
        </aside>

        <main class="content-area">
            <div class="top-bar" style="flex-direction:column; align-items:stretch; gap:15px; height:auto; padding-bottom:15px;">
                
                <div style="display:flex; gap:10px; width:100%; align-items:center;">
                    <input type="text" id="main-search-inp" class="search-inp" style="flex:1;" placeholder="Buscar en la Nube y en Osu! Mania..." oninput="debounceSearch(this.value)">
                    
                    <div id="notif-bell" onclick="openNotifPanel()" style="position:relative; cursor:pointer; font-size:1.8rem; margin:0 15px; filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));">
                        üîî<span id="notif-badge" style="display:none; position:absolute; top:-5px; right:-10px; background:#F9393F; color:white; border-radius:10px; padding:2px 6px; font-size:0.7rem; font-weight:900; border:2px solid #0a0a0a;">0</span>
                    </div>

                    <div style="display:flex; gap:20px; align-items:center;">
                         <div style="font-weight:900; color:var(--gold);">SP: <span id="h-sp" style="color:white; font-size:1.5rem;">0</span></div>
                         <div style="font-weight:900; color:#aaa;">PP: <span id="h-pp" style="color:white; font-size:1.5rem;">0</span></div>
                    </div>
                </div>

                <div id="filter-bar" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                    <button class="filter-btn active" data-type="type" data-val="all" onclick="setFilter('type', 'all')">TODO</button>
                    <button class="filter-btn" data-type="type" data-val="osu" onclick="setFilter('type', 'osu')" style="color:#ff66aa; border-color:#ff66aa;">üå∏ OSU!</button>
                    <button class="filter-btn" data-type="type" data-val="com" onclick="setFilter('type', 'com')">‚òÅÔ∏è COMUNIDAD</button>
                    <button class="filter-btn" data-type="type" data-val="recent" onclick="setFilter('type', 'recent')" style="color:var(--gold); border-color:var(--gold);">üïí RECIENTES</button>
                    
                    <div style="width:2px; height:20px; background:#444; margin:0 5px;"></div>
                    
                    <button class="filter-btn active" data-type="key" data-val="all" onclick="setFilter('key', 'all')">CUALQUIER TECLA</button>
                    <button class="filter-btn" data-type="key" data-val="1" onclick="setFilter('key', '1')">1K</button>
                    <button class="filter-btn" data-type="key" data-val="2" onclick="setFilter('key', '2')">2K</button>
                    <button class="filter-btn" data-type="key" data-val="3" onclick="setFilter('key', '3')">3K</button>
                    <button class="filter-btn" data-type="key" data-val="4" onclick="setFilter('key', '4')">4K</button>
                    <button class="filter-btn" data-type="key" data-val="5" onclick="setFilter('key', '5')">5K</button>
                    <button class="filter-btn" data-type="key" data-val="6" onclick="setFilter('key', '6')">6K</button>
                    <button class="flter-btn" data-type="key" data-val="7" onclick="setFilter('key', '7')">7K</button>
                    <button class="filter-btn" data-type="key" data-val="8" onclick="setFilter('key', '8')">8K</button>
                    <button class="filter-btn" data-type="key" data-val="9" onclick="setFilter('key', '9')">9K</button>
                    <button class="filter-btn" data-type="key" data-val="10" onclick="setFilter('key', '10')">10K</button>
                </div>
            </div>
            <div class="song-grid" id="song-grid"></div>
        </main>
    </div>

    <div id="game-layer" style="display:none;">
        <div id="mobile-touch-zones" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 900; flex-direction: row;"></div>
        <div id="top-progress-bar">
            <div id="top-progress-fill"></div>
            <div id="top-progress-time">0:00 / 0:00</div>
        </div>
        
        <div id="mobile-pause-btn" onclick="togglePause()">‚è∏</div>
        <div id="vs-hud">
            <div id="multi-players-container"></div>
        </div>

        <div id="ig-profile">
            <div id="ig-av"></div>
            <div id="ig-name" style="color:white;">User</div>
        </div>

        <div id="combo-container">
            <div class="combo-label">COMBO</div>
            <div id="g-combo" class="combo-val">0</div>
            <div id="hud-fc" class="hud-fc">GFC</div>
            <div id="hud-mean" class="hud-mean">0.00ms</div>
        </div>

        <div id="track"></div>

        <div id="hud">
            <div class="stats-col">
                <div style="color:var(--sick)" class="stat-item">SICK <span id="h-sick">0</span></div>
                <div style="color:var(--good)" class="stat-item">GOOD <span id="h-good">0</span></div>
                <div style="color:var(--bad)" class="stat-item">BAD <span id="h-bad">0</span></div>
                <div style="color:var(--miss)" class="stat-item">MISS <span id="h-miss">0</span></div>
                
                <div class="acc-block">
                    <div class="acc-label">ACCURACY</div>
                    <div class="acc-val" id="g-acc">100%</div>
                </div>

                <div class="score-label">SCORE</div>
                <div class="score-val" id="g-score">0</div>
            </div>
            <div class="health-bar"><div class="health-fill" id="health-fill"></div></div>
        </div>
        
        <div id="countdown" style="position:absolute; width:100%; height:100%; display:flex; align-items:center; justify-content:center; pointer-events:none; z-index:600; font-size:15rem; font-weight:900; color:white; text-shadow:0 0 60px black;"></div>
    </div>

    <div id="modal-settings" class="modal-overlay"><div class="modal-panel settings-panel"></div></div>

    <div id="modal-diff" class="modal-overlay">
        <div class="modal-panel" style="width:1000px;">
            <div class="m-title">SELECCIONA MODO</div>
            <div id="diff-song-cover" style="width:200px; height:200px; background:#333; margin:0 auto 20px; border-radius:15px; background-size:cover; background-position:center; border:3px solid var(--accent); box-shadow:0 0 40px rgba(255,102,170,0.2);"></div>
            <div id="diff-song-title" style="text-align:center; font-size:2rem; font-weight:900; margin-bottom:30px; color:white;">...</div>

            <div class="diff-grid">
                <div class="diff-card" onclick="startGame(4)" style="color:#00FFFF; border-color:#00FFFF;">
                    <div class="diff-bg-icon">4K</div>
                    <div class="diff-num">4K</div>
                    <div class="diff-label">EASY</div>
                </div>
                <div class="diff-card" onclick="startGame(6)" style="color:#12FA05; border-color:#12FA05;">
                    <div class="diff-bg-icon">6K</div>
                    <div class="diff-num">6K</div>
                    <div class="diff-label">NORMAL</div>
                </div>
                <div class="diff-card" onclick="startGame(7)" style="color:#FFD700; border-color:#FFD700;">
                    <div class="diff-bg-icon">7K</div>
                    <div class="diff-num">7K</div>
                    <div class="diff-label">INSANE</div>
                </div>
                <div class="diff-card" onclick="startGame(9)" style="color:#F9393F; border-color:#F9393F;">
                    <div class="diff-bg-icon">9K</div>
                    <div class="diff-num">9K</div>
                    <div class="diff-label">DEMON</div>
                </div>
            </div>
            
            <div class="ranked-toggle">
                <input type="checkbox" id="chk-ranked">
                <label for="chk-ranked" style="margin-left:10px; color:var(--accent);">RANKED MODE (GANA PP)</label>
            </div>
            
            <div id="create-lobby-opts" style="display:none; margin-top:20px;">
                <button class="action" onclick="confirmCreateLobby()">CREAR SALA ONLINE</button>
            </div>

            <button class="action secondary" style="margin-top:20px;" onclick="closeModal('diff')">CANCELAR</button>
        </div>
    </div>

    <div id="modal-finish-reg" class="modal-overlay" style="z-index: 6000;">
        <div class="modal-panel login-box">
            <div class="m-title">CASI LISTO</div>
            <input type="text" id="reg-google-user" class="log-inp" placeholder="Nombre de Usuario">
            <button class="action" onclick="finishGoogleRegistration()">CREAR CUENTA</button>
        </div>
    </div>

    <div id="modal-song-selector" class="modal-overlay">
        <div class="modal-panel" style="width:800px; height:80vh;">
            <div class="m-title">ELIGE CANCI√ìN</div>
            <input type="text" class="search-inp" style="width:100%;" placeholder="Buscar..." oninput="renderLobbySongList(this.value)">
            <div class="song-grid" id="lobby-song-grid" style="padding:10px;"></div>
            <button class="action secondary" onclick="closeModal('song-selector')">CANCELAR</button>
        </div>
    </div>

    <div id="modal-upload" class="modal-overlay">
        <div class="modal-panel settings-panel" style="max-width: 900px; height: auto; display: flex; flex-direction: column;">
            <div class="settings-header">
                <div class="m-title" style="margin:0; border:none; text-align:left; color: white;">‚òÅÔ∏è STUDIO: SUBIR CANCI√ìN</div>
                <button class="action secondary" style="width:auto; padding:10px 20px;" onclick="closeModal('upload')">X</button>
            </div>

            <div class="settings-content" style="display:flex; gap: 30px; padding: 30px;">
                <div style="flex:1; display:flex; flex-direction:column; gap:20px;">
                    <div>
                        <div style="color:var(--accent); font-weight:900; margin-bottom:5px;">T√çTULO</div>
                        <input type="text" id="up-title" class="log-inp" placeholder="Ej: Alan Walker - Faded" style="margin:0;">
                    </div>

                    <div style="background:#111; padding:20px; border-radius:12px; border:1px solid #333;">
                        <div style="color:var(--blue); font-weight:900; margin-bottom:10px;">üéß ARCHIVO MP3</div>
                        <div style="display:flex; gap:10px; margin-bottom:15px;">
                            <button class="action" id="btn-up-audio" onclick="triggerAudioUpload()" style="flex:1; font-size: 0.9rem;">SUBIR MP3</button>
                        </div>
                        <div id="lbl-up-audio" style="margin-top:15px; font-weight: bold; color:#666; text-align:center;">Ning√∫n archivo seleccionado</div>
                    </div>

                    <input type="hidden" id="up-url" value="">
                    <input type="hidden" id="up-lyrics" value="">
                </div> 
                <div style="width: 250px; display:flex; flex-direction:column; gap:10px;">
                    <div style="color:var(--gold); font-weight:900;">üñºÔ∏è PORTADA (Opcional)</div>
                    <div id="up-cover-preview" style="width:100%; aspect-ratio: 1; background:#0a0a0a; border:2px dashed #444; border-radius:12px; display:flex; align-items:center; justify-content:center; flex-direction:column; cursor:pointer; background-size:cover; background-position:center;" onclick="triggerCoverUpload()">
                        <span style="font-size:3rem;">üì∑</span><span style="color:#888; font-weight:bold;">Subir Imagen</span>
                    </div>
                </div>
            </div>

            <div class="settings-header" style="border-top:1px solid #222; border-bottom:none; justify-content:flex-end; background: #080808; padding: 20px 30px;">
                <button class="action btn-acc" id="btn-publish-song" style="width:auto; padding:15px 40px;" onclick="submitSongToFirebase()">PUBLICAR CANCI√ìN</button>
            </div>
        </div>
    </div>

    <div id="modal-lobbies" class="modal-overlay">
        <div class="modal-panel" style="width:800px;">
            <div class="m-title">SALAS ONLINE</div>
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                 <button class="btn-small btn-add" onclick="openSongSelectorForLobby()">CREAR SALA</button>
                 <button class="btn-small btn-chat" onclick="refreshLobbies()">ACTUALIZAR</button>
            </div>
            <div id="lobby-list"></div>
            <button class="action secondary" onclick="closeModal('lobbies')">CERRAR</button>
        </div>
    </div>

   <div id="modal-host" class="modal-overlay">
        <div class="modal-panel" style="width:700px; text-align:center;">
            <div class="m-title" id="room-host-name">SALA</div>
            <div style="margin-bottom:20px;" id="room-song">...</div>
            <div id="room-players" style="display:flex; gap:20px; justify-content:center;"></div>
            <button class="action btn-acc" id="btn-ready" onclick="toggleReady()">LISTO</button>
            <button class="action secondary" onclick="leaveLobby()">SALIR</button>
        </div>
    </div>

    <div id="modal-shop" class="modal-overlay">
        <div class="modal-panel" style="width:800px;">
            <div class="m-title">TIENDA</div>
            <div style="text-align:center; margin-bottom:20px;">SP: <span id="shop-sp">0</span></div>
            <div class="shop-grid" id="shop-items"></div>
            <button class="action secondary" onclick="closeModal('shop')">CERRAR</button>
        </div>
    </div>
    
    <div id="modal-osu" class="modal-overlay">
        <div class="modal-panel" style="width:900px; height:85vh; display:flex; flex-direction:column;">
            <div class="m-title" style="color:#ff66aa; border-bottomColor:#ff66aa;">üå∏ OSU! MANIA BROWSER</div>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <input type="text" id="osu-search-inp" class="log-inp" style="flex:1; margin:0;" placeholder="Buscar canci√≥n, artista o anime..." onkeydown="if(event.key==='Enter') searchOsu()">
                <button class="action" style="width:auto; padding:0 30px; background:#ff66aa; color:black;" onclick="searchOsu()">BUSCAR</button>
            </div>
            <div id="osu-status" style="text-align:center; color:#888; margin-bottom:10px; font-weight:bold;">Busca cualquier mapa de Osu! Mania (4K, 7K, etc.)</div>
            <div id="osu-results" class="song-grid" style="flex:1; overflow-y:auto; padding:10px; border:1px solid #333; border-radius:10px;"></div>
            <button class="action secondary" style="margin-top:20px;" onclick="closeModal('osu')">CERRAR</button>
        </div>
    </div>

    <div id="modal-news" class="modal-overlay">
        <div class="modal-panel" style="width:600px;">
            <div class="m-title">NOVEDADES ULTRA</div>
            <div class="patch-text">
                <ul>
                    <li><b>UI REMASTER:</b> Nuevo selector de modo, men√∫ de ajustes y HUD.</li>
                    <li><b>HOLD NOTES:</b> L√≥gica de notas largas mejorada.</li>
                    <li><b>INDICADORES:</b> Mean MS y Full Combo status en vivo.</li>
                </ul>
            </div>
            <button class="action secondary" onclick="closeModal('news')">CERRAR</button>
        </div>
    </div>

    <div id="modal-studio" class="modal-overlay">
        <div class="modal-panel" style="width:900px; height:85vh; display:flex; flex-direction:column;">
            <div class="m-title" style="color:#00ffff; border-bottomColor:#00ffff;">‚úèÔ∏è MIS CREACIONES</div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <div style="color:#aaa;">Aqu√≠ est√°n todas las canciones que has subido a la Nube. ¬°A√±√°deles notas!</div>
                <button class="action" style="width:auto; padding:5px 20px;" onclick="closeModal('studio'); openModal('upload')">‚òÅÔ∏è SUBIR NUEVA CANCI√ìN</button>
            </div>
            <div id="studio-loading" style="text-align:center; color:var(--gold); padding:20px; font-weight:bold;">Buscando tus canciones en la Nube... ‚è≥</div>
            <div id="studio-grid" class="song-grid" style="flex:1; overflow-y:auto; padding:10px; border:1px solid #333; border-radius:10px;"></div>
            <button class="action secondary" style="margin-top:20px;" onclick="closeModal('studio')">CERRAR STUDIO</button>
        </div>
    </div>
    
    <div id="modal-friend-profile" class="modal-overlay">
        <div class="modal-panel login-box">
            <div id="fp-av" class="prof-av-big"></div>
            <h2 id="fp-name">...</h2>
            <div id="fp-lvl">LVL ...</div>
            <div id="fp-stats"><div class="fp-stat-box">SCORE<br><span id="fp-score">0</span></div></div>
            <div id="fp-status-text">...</div>
            <div class="fp-actions">
                <button class="btn-chat" onclick="openFloatingChat()">üí¨</button>
                <button id="btn-challenge" class="btn-add" disabled>‚öîÔ∏è</button>
            </div>
            <button class="action secondary" onclick="closeModal('friend-profile')">CERRAR</button>
        </div>
    </div>

    <div id="modal-profile" class="modal-overlay">
        <div class="modal-panel" style="width: 95%; max-width: 800px; padding:0; overflow:hidden; background:#0a0a0a; border-radius: 15px; border: 1px solid #333;">
            
            <div id="login-view" style="padding: 40px; text-align:center;">
                <div class="m-title" style="color:var(--accent); border-color:var(--accent);">INICIAR SESI√ìN</div>
                <button class="btn-google" onclick="loginGoogle()" style="margin-bottom:20px;">ENTRAR CON GOOGLE</button>
                <input type="text" id="l-user" class="log-inp" placeholder="Usuario Local (Opcional)">
                <input type="password" id="l-pass" class="log-inp" placeholder="Contrase√±a Local">
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button class="action" onclick="login()" style="flex:1;">ENTRAR</button>
                    <button class="action secondary" onclick="register()" style="flex:1;">REGISTRAR</button>
                </div>
                <button class="action secondary" style="margin-top:20px; width:100%;" onclick="closeModal('profile')">CERRAR</button>
            </div>

            <div id="profile-view" style="display:none;">
                <div id="p-header-bg" style="height:220px; background:linear-gradient(to bottom, transparent, #0a0a0a), url('icon.png') center/cover; position:relative; transition: all 0.4s ease;">
    
    <div id="p-top-badge" style="display:none; position:absolute; top:-30px; left:-20px; font-size:6rem; font-weight:900; transform:rotate(-15deg); z-index:10; font-family:sans-serif; letter-spacing:-5px;">
        #1
    </div>

    <button class="action secondary" style="position:absolute; right:15px; top:15px; width:auto; padding:5px 15px; background: rgba(0,0,0,0.6); z-index: 10; border:1px solid #555;" onclick="closeModal('profile')">CERRAR X</button>

    <label id="btn-edit-banner" style="display:none; position:absolute; bottom:15px; right:15px; background:rgba(0,0,0,0.8); color:white; padding:8px 20px; border-radius:10px; cursor:pointer; font-weight:bold; border:1px solid var(--accent); z-index: 10; transition: 0.2s; box-shadow: 0 0 10px rgba(255,102,170,0.3);">
        ‚úèÔ∏è Cambiar Banner
        <input type="file" accept="image/*" style="display:none" onchange="uploadBanner(this)">
    </label>
                </div>
                
                <div style="padding: 0 5% 40px 5%; position:relative; top:-60px;">
                    
                    <div class="profile-header-flex" style="display:flex; align-items:flex-end; gap:25px;">
                        <label class="prof-av-big" id="p-av-big" style="width:130px; height:130px; border-radius:20px; border:4px solid var(--accent); background-color:#111; background-size:cover; background-position:center; position:relative; z-index:2; cursor:pointer;">
                            <input type="file" accept="image/*" style="display:none" onchange="uploadAvatar(this)" id="avatar-upload-input">
                        </label>
                        <div style="flex:1; padding-bottom: 10px;">
                            <h2 id="p-name" style="margin:0; font-size:3rem; font-weight:900; text-shadow:0 4px 10px rgba(0,0,0,0.8); color:white; line-height: 1;">User</h2>
                            <div style="display:flex; gap:15px; align-items:center; margin-top:5px;">
                                <div id="p-lvl-txt" style="color:var(--gold); font-weight:900; font-size:1.2rem; letter-spacing: 2px;">LVL 1</div>
                                <div id="p-online-status" style="font-size: 13px; font-weight:bold; background:rgba(0,0,0,0.5); padding:2px 8px; border-radius:10px;">‚ö™ Offline</div>
                            </div>
                            <div id="p-custom-status" style="color: var(--accent); font-style: italic; font-size: 14px; margin-top: 5px;"></div>
                        </div>
                        <div style="text-align:right; padding-bottom: 10px;">
                            <div style="font-size:0.9rem; color:#888; font-weight:bold; letter-spacing: 1px;">RANKING GLOBAL</div>
                            <div id="p-global-rank" style="font-size:2.5rem; font-weight:900; color:white; text-shadow: 0 0 15px rgba(255,255,255,0.3);">#--</div>
                        </div>
                    </div>

                    <div id="p-bio" style="font-size: 14px; color: #ddd; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 3px solid var(--accent); line-height:1.5;"></div>

                    <div id="profile-main-stats">
                        <div class="xp-container" style="margin-top:20px; height:18px; background:#1a1a1a; border-radius:10px; border: 1px solid #333; overflow:hidden;">
                            <div class="xp-fill" id="p-xp-bar" style="height:100%; background:linear-gradient(90deg, #ff66aa, #00ffff); width:0%; transition: width 0.5s;"></div>
                        </div>

                        <div class="profile-stats-grid" style="display:grid; grid-template-columns:repeat(4, 1fr); gap:15px; margin-top:25px;">
                            <div style="background:linear-gradient(145deg, #1a1a1a, #111); padding:20px 10px; border-radius:12px; text-align:center; border:1px solid #222;">
                                <div style="color:#aaa; font-size:0.75rem; font-weight:bold; margin-bottom:5px;">PERFORMANCE</div>
                                <div id="p-pp-display" style="color:var(--accent); font-size:1.8rem; font-weight:900;">0 <span style="font-size:1rem;">PP</span></div>
                            </div>
                            <div style="background:linear-gradient(145deg, #1a1a1a, #111); padding:20px 10px; border-radius:12px; text-align:center; border:1px solid #222;">
                                <div style="color:#aaa; font-size:0.75rem; font-weight:bold; margin-bottom:5px;">TOTAL SCORE</div>
                                <div id="p-score" style="color:white; font-size:1.8rem; font-weight:900;">0</div>
                            </div>
                            <div style="background:linear-gradient(145deg, #1a1a1a, #111); padding:20px 10px; border-radius:12px; text-align:center; border:1px solid #222;">
                                <div style="color:#aaa; font-size:0.75rem; font-weight:bold; margin-bottom:5px;">PARTIDAS</div>
                                <div id="p-plays" style="color:var(--blue); font-size:1.8rem; font-weight:900;">0</div>
                            </div>
                            <div style="background:linear-gradient(145deg, #1a1a1a, #111); padding:20px 10px; border-radius:12px; text-align:center; border:1px solid #222;">
                                <div style="color:#aaa; font-size:0.75rem; font-weight:bold; margin-bottom:5px;">SP AHORRADO</div>
                                <div id="p-sp-display" style="color:var(--gold); font-size:1.8rem; font-weight:900;">0</div>
                            </div>
                        </div>

                        <div class="profile-equip-flex" style="margin-top:20px; display:flex; gap:15px;">
                            <div style="flex:1; background:#111; padding:15px; border-radius:12px; border:1px solid #333; display:flex; align-items:center; gap:15px;">
                                <div style="font-size:2rem;">üé®</div>
                                <div><div style="color:#888; font-size:0.75rem;">SKIN DE NOTAS</div><div id="p-equipped-skin" style="font-weight:900; color:#00ffff;">Default</div></div>
                            </div>
                            <div style="flex:1; background:#111; padding:15px; border-radius:12px; border:1px solid #333; display:flex; align-items:center; gap:15px;">
                                <div style="font-size:2rem;">üñºÔ∏è</div>
                                <div><div style="color:#888; font-size:0.75rem;">MARCO EQUIPADO</div><div id="p-equipped-ui" style="font-weight:900; color:#ff66aa;">Ninguno</div></div>
                            </div>
                        </div>
                        
                        <div id="p-owner-actions" style="display:none; gap:15px; margin-top:25px;">
                            <button class="action secondary" style="flex:1;" onclick="toggleProfileSettings(true)">‚öôÔ∏è AJUSTES Y PRIVACIDAD</button>
                        </div>

                        <div id="p-visitor-actions" style="display:none; gap:15px; margin-top:25px;">
                            <button class="action" style="flex:1; background:var(--good); color:black;" id="btn-add-friend">‚ûï AGREGAR AMIGO</button>
                            <button class="action" style="flex:1; background:var(--blue); color:white;" id="btn-chat-user">üí¨ CHATEAR</button>
                            <button class="action" style="flex:1; background:var(--gold); color:black;" id="btn-challenge-user">‚öîÔ∏è DESAFIAR</button>
                        </div>
                    </div>

                    <div id="profile-account-settings" style="display:none; margin-top:20px; background:#111; padding:20px; border-radius:12px; border:1px solid #333;">
                        <h3 style="color:var(--accent); margin-top:0;">‚öôÔ∏è PRIVACIDAD Y ESTADO</h3>
                        <input type="text" id="inp-custom-status" class="log-inp" placeholder="Escribe un estado (Ej: Jugando Osu!)">
                        <textarea id="inp-bio" class="log-inp" placeholder="Escribe tu biograf√≠a aqu√≠..." style="height:80px; resize:none;"></textarea>
                        
                        <div class="ranked-toggle" style="margin-bottom:20px;">
                            <input type="checkbox" id="chk-hide-items">
                            <label for="chk-hide-items" style="margin-left:10px; color:white;">Ocultar mis √çtems (Skins/Marcos) a los dem√°s</label>
                        </div>
                        
                        <button class="action secondary" style="width:100%; margin-bottom:10px;" onclick="saveProfilePrivacy()">GUARDAR CAMBIOS</button>
                        
                        <div id="acc-mgmt-area" style="padding-top:20px; border-top:1px solid #333; margin-top:20px;">
                            <button class="action secondary" style="width:100%; border-color:#F9393F; color:#F9393F;" onclick="logout()">CERRAR SESI√ìN DE LA CUENTA</button>
                        </div>

                        <button class="action" style="width:100%; background:#444; color:white; margin-top:15px;" onclick="toggleProfileSettings(false)">‚¨Ö VOLVER</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="modal-rank" class="modal-overlay">
            <div class="modal-panel" style="width:700px; padding:0; background:#0a0a0a; border-radius:15px; overflow:hidden;">
                <div style="padding:20px 30px; background:#111; border-bottom:2px solid var(--accent); display:flex; justify-content:space-between; align-items:center;">
                    <h2 style="margin:0; color:white; font-weight:900; font-size:1.8rem;">üèÜ RANKING GLOBAL</h2>
                    <button class="action secondary" style="width:auto; padding:5px 15px;" onclick="closeModal('rank')">CERRAR</button>
                </div>
                <div id="rank-list" style="padding:20px; max-height:60vh; overflow-y:auto; display:flex; flex-direction:column; gap:10px;"></div>
            </div>
        </div>

        <div id="modal-friends" class="modal-overlay">
            <div class="modal-panel" style="width:650px; padding:0; background:#0a0a0a; border-radius:15px; overflow:hidden;">
                <div style="padding:20px 30px; background:#111; border-bottom:2px solid #00ffff; display:flex; justify-content:space-between; align-items:center;">
                    <h2 style="margin:0; color:white; font-weight:900; font-size:1.8rem;">üë• AMIGOS</h2>
                    <button class="action secondary" style="width:auto; padding:5px 15px;" onclick="closeModal('friends')">CERRAR</button>
                </div>
                <div style="padding:20px;">
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <input type="text" id="friend-inp" class="log-inp" style="margin:0; flex:1;" placeholder="Usuario a buscar...">
                        <button class="action" style="width:auto; background:#00ffff; color:black; padding:0 30px;" onclick="sendFriendRequest()">AGREGAR</button>
                    </div>
                    
                    <div style="color:var(--accent); font-weight:bold; margin-bottom:10px; font-size:0.9rem;">SOLICITUDES PENDIENTES</div>
                    <div id="req-list" style="margin-bottom:20px;"></div>
                    
                    <div style="color:var(--good); font-weight:bold; margin-bottom:10px; font-size:0.9rem;">TU LISTA DE AMIGOS</div>
                    <div id="friend-list" style="display:flex; flex-direction:column; gap:10px; max-height:40vh; overflow-y:auto;"></div>
                </div>
            </div>
        </div>

        <div id="modal-pause" class="modal-overlay">
            <div class="modal-panel login-box">
                <div class="m-title">PAUSA</div>
                <div style="font-size:3rem; font-weight:900; color:var(--blue);">ACC: <span id="p-acc">100%</span></div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; font-size:1.5rem; margin-bottom:30px;">
                    <div style="color:var(--sick)">SICK: <span id="p-sick">0</span></div>
                    <div style="color:var(--good)">GOOD: <span id="p-good">0</span></div>
                    <div style="color:var(--bad)">BAD: <span id="p-bad">0</span></div>
                    <div style="color:var(--miss)">MISS: <span id="p-miss">0</span></div>
                </div>
                <button class="action" onclick="resumeGame()">CONTINUAR</button>
                <button class="action secondary" onclick="toMenu()">SALIR</button>
            </div>
        </div>

        <div id="modal-res" class="modal-overlay">
            <div class="modal-panel login-box" style="width:600px;">
                <div class="m-title">RESULTADOS</div>
                <div class="res-rank" id="res-rank">S</div>
                <div id="winner-msg" style="display:none;">¬°GANASTE!</div>
                <div style="font-size:4rem; font-weight:900;" id="res-score">0</div>
                <div style="color:#aaa; font-size:1.5rem;">ACC: <span id="res-acc" style="color:white;">100%</span></div>
                <div id="pp-gain-loss" style="color:var(--gold); font-weight:bold; margin-top:15px;">+0 PP</div>
                <div style="display:flex; justify-content:space-around; margin-top:15px;">
                    <div style="color:var(--blue);">+<span id="res-xp">0</span> XP</div>
                    <div style="color:var(--gold);">+<span id="res-sp">0</span> SP</div>
                </div>
                <button class="action" onclick="toMenu()">VOLVER</button>
            </div>
        </div>

        <div id="notif-panel" style="display:none; position:absolute; top:80px; right:50px; width:350px; background:#111; border:2px solid #333; border-radius:10px; z-index:9999; box-shadow:0 10px 30px rgba(0,0,0,0.8); overflow:hidden;">
            <div style="background:#0a0a0a; padding:15px; border-bottom:1px solid #333; display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0; color:white;">Notificaciones</h3>
                <button style="background:none; border:none; color:#888; cursor:pointer;" onclick="if(typeof clearAllNotifs==='function')clearAllNotifs()">Limpiar Todo</button>
            </div>
            <div id="notif-list-content" style="max-height:400px; overflow-y:auto; padding:10px;">
                <div style="text-align:center; color:#666; padding:20px;">No tienes notificaciones nuevas.</div>
            </div>
        </div>

        <script src="js/globals.js"></script>
        <script src="js/script/core.js"></script>
        <script src="js/script/modals.js"></script>

        <script src="js/auth.js"></script>
        <script src="js/online.js"></script>

        <script src="js/script/profile.js"></script>
        <script src="js/script/settings.js"></script>
        <script src="js/script/controls.js"></script>
        <script src="js/script/song_browser.js"></script>
        <script src="js/script/diff_modals.js"></script>
        <script src="js/script/socials.js"></script>
        <script src="js/script/chat_notify.js"></script>
        <script src="js/script/multiplayer.js"></script>
        <script src="js/script/studio_upload.js"></script>
        <script src="js/script/shop_audio.js"></script>

        <script src="js/game.js"></script>
        <script src="js/osu.js"></script>
        <script src="js/editor.js"></script>
        <script src="js/main.js"></script>
    </body>
</html>
