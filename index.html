<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A NOTES GAME</title>
    <link rel="icon" type="image/png" href="icon.png">

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="notification-area"></div>
    <div id="chat-overlay-container"></div>
    <div id="loading-overlay" style="display:none;">
        <div class="loader"></div>
        <div id="loading-text">Cargando...</div>
    </div>

    <div id="bg-layer">
        <video id="bg-video" loop muted playsinline style="display:none;"></video>
        
            </div>

            <div class="nav-section">
                <button class="nav-btn active" id="nav-songs" onmouseenter="playHover()" onclick="changeSection('songs')">üéµ CANCIONES</button>
                <button class="nav-btn active" id="nav-songs" onmouseenter="playHover()" onclick="changeSection('songs')">üéµ CANCIONES GLOBALES</button>
                <button class="nav-btn" id="nav-multi" onmouseenter="playHover()" onclick="openLobbyBrowser()">‚öîÔ∏è SALAS ONLINE</button>
                <button class="nav-btn" id="nav-shop" onmouseenter="playHover()" onclick="openShop()">üõí TIENDA</button>
                <button class="nav-btn" id="nav-settings" onmouseenter="playHover()" onclick="openModal('settings')">‚öôÔ∏è AJUSTES</button>
                <button class="nav-btn" id="nav-rank" onmouseenter="playHover()" onclick="openLeaderboard()">üåê RANKING</button>
                <button class="nav-btn" id="nav-friends" onmouseenter="playHover()" onclick="openFriends()">üë• AMIGOS</button>
            </div>

            <label class="import-btn" id="imp-btn" onmouseenter="playHover()">
                <span id="imp-txt">üìÇ IMPORTAR CANCION</span>
                <input type="file" id="imp-input" accept="audio/*" style="display:none" onchange="handleAudio(this)" onclick="this.value=null">
            </label>
            <button class="import-btn" id="imp-btn" onmouseenter="playHover()" onclick="openModal('upload')">
                <span id="imp-txt">‚òÅÔ∏è SUBIR CANCI√ìN</span>
            </button>
            <button class="news-btn" onclick="openModal('news')">üì∞ NOVEDADES</button>
        </aside>

        <main class="content-area">
            <div class="top-bar">
                <input type="text" class="search-inp" placeholder="Buscar canci√≥n..." oninput="renderMenu(this.value)">
                <input type="text" class="search-inp" placeholder="Buscar en la nube..." oninput="renderMenu(this.value)">
                <div style="display:flex; gap:20px; align-items:center;">
                     <div style="font-weight:900; color:var(--gold);">SP: <span id="h-sp" style="color:white; font-size:1.5rem;">0</span></div>
                     <div style="font-weight:900; color:#aaa;">PP: <span id="h-pp" style="color:white; font-size:1.5rem;">0</span></div>

    </div>

    <div id="game-layer">
        <div id="top-progress-bar">
            <div id="top-progress-fill"></div>
            <div id="top-progress-time">0:00 / 0:00</div>
        </div>

        <div id="vs-hud">
            <div id="multi-players-container"></div>
        </div>

                <div style="color:var(--good)" class="stat-item">GOOD <span id="h-good">0</span></div>
                <div style="color:var(--bad)" class="stat-item">BAD <span id="h-bad">0</span></div>
                <div style="color:var(--miss)" class="stat-item">MISS <span id="h-miss">0</span></div>
                
                <div class="acc-block">
                    <div class="acc-label">ACCURACY</div>
                    <div class="acc-val" id="g-acc">100%</div>
                </div>

                <div class="score-label">SCORE</div>
                <div class="score-val" id="g-score">0</div>
                <div class="acc-block"><div class="acc-label">ACCURACY</div><div class="acc-val" id="g-acc">100%</div></div>
                <div class="score-label">SCORE</div><div class="score-val" id="g-score">0</div>
            </div>
            
            <div class="health-bar"><div class="health-fill" id="health-fill"></div></div>
        </div>

        <div class="combo-val" id="g-combo">0</div>
        <div id="countdown" style="position:absolute; width:100%; height:100%; display:flex; align-items:center; justify-content:center; pointer-events:none; z-index:600; font-size:15rem; font-weight:900; color:white; text-shadow:0 0 60px black;"></div>
    </div>

    <div id="modal-news" class="modal-overlay">
        <div class="modal-panel" style="width:600px;">
            <div class="m-title">NOVEDADES</div>
            <div class="patch-text">
                <div class="patch-ver">VERSION 0.9 (MEGA UPDATE)</div>
                <ul>
                    <li><b>LOBBIES 4 JUGADORES:</b> Crea salas y juega con hasta 4 personas a la vez.</li>
                    <li><b>SISTEMA DE XP MEJORADO:</b> Curva de nivel ajustada y m√°s r√°pida.</li>
                    <li><b>SCORE POINTS (SP):</b> Nueva moneda para la tienda (gana jugando).</li>
                    <li><b>CHAT GLOBAL:</b> Ventanas de chat persistentes estilo Roblox.</li>
                    <li><b>NOTIFICACIONES OFFLINE:</b> Las solicitudes llegan aunque no est√©s conectado.</li>
                </ul>
            </div>
            <button class="action secondary" onclick="closeModal('news')">CERRAR</button>
        </div>
    </div>

    <div id="modal-shop" class="modal-overlay">
        <div class="modal-panel" style="width:800px;">
            <div class="m-title">TIENDA (SP)</div>
            <div style="text-align:center; margin-bottom:20px; color:var(--gold); font-size:1.5rem; font-weight:900;">TUS PUNTOS: <span id="shop-sp">0</span> SP</div>
            <div class="shop-grid" id="shop-items">
                <div class="shop-item">
                    <div class="shop-icon" style="background:var(--blue)"></div>
                    <div class="shop-name">Skin: Blue Neon</div>
                    <div class="shop-price">1000 SP</div>
                    <button class="btn-small btn-add" style="width:100%">COMPRAR</button>
                </div>
                 <div class="shop-item">
                    <div class="shop-icon" style="background:var(--accent)"></div>
                    <div class="shop-name">Skin: Pink Vibes</div>
                    <div class="shop-price">2500 SP</div>
                    <button class="btn-small btn-add" style="width:100%">COMPRAR</button>
                </div>
            </div>
            <button class="action secondary" onclick="closeModal('shop')">CERRAR</button>
        </div>
    </div>

    <div id="modal-lobbies" class="modal-overlay">
        <div class="modal-panel" style="width:800px;">
            <div class="m-title">SALAS DE JUEGO</div>
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                 <button class="btn-small btn-add" onclick="createLobbyUI()">CREAR SALA</button>
                 <button class="btn-small btn-chat" onclick="refreshLobbies()">ACTUALIZAR</button>
            </div>
            <div id="lobby-list" style="max-height:400px; overflow-y:auto;">
                </div>
            <button class="action secondary" onclick="closeModal('lobbies')">CERRAR</button>
        </div>
    </div>

    <div id="modal-lobby-room" class="modal-overlay">
        <div class="modal-panel" style="width:700px; text-align:center;">
            <div class="m-title" id="room-host-name">SALA DE ...</div>
            <div style="margin-bottom:20px; font-size:1.2rem; color:var(--blue);">CANCI√ìN: <span id="room-song">...</span></div>
            <div id="room-players" style="display:flex; gap:20px; justify-content:center; margin-bottom:30px;">
                </div>
            <button class="action btn-acc" id="btn-ready" onclick="toggleReady()">LISTO</button>
            <button class="action secondary" onclick="leaveLobby()">SALIR</button>
        </div>
    </div>

    <div id="modal-friends" class="modal-overlay">
        <div class="modal-panel" style="width:650px;">
            <div class="m-title">SOCIAL HUB</div>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <input type="text" id="friend-inp" class="log-inp" placeholder="Nombre de usuario..." style="margin:0;">
                <button class="btn-small btn-add" style="font-size:1rem;" onclick="sendFriendRequest()">AGREGAR</button>
            </div>
            <div style="color:#aaa; font-weight:bold; margin-bottom:10px;">SOLICITUDES</div>
            <div id="req-list" class="friend-list" style="margin-bottom:20px;"></div>
            <div style="color:#aaa; font-weight:bold; margin-bottom:10px;">AMIGOS</div>
            <div id="friend-list" class="friend-list"></div>
            <button class="action secondary" onclick="closeModal('friends')">CERRAR</button>
    <div id="modal-song-selector" class="modal-overlay">
        <div class="modal-panel" style="width:800px; height:80vh;">
            <div class="m-title">ELIGE CANCI√ìN PARA EL HOST</div>
            <input type="text" class="search-inp" style="width:100%; margin-bottom:20px;" placeholder="Buscar..." oninput="renderLobbySongList(this.value)">
            <div class="song-grid" id="lobby-song-grid" style="padding:10px; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));"></div>
            <button class="action secondary" style="margin-top:20px;" onclick="closeModal('song-selector')">CANCELAR</button>
        </div>
    </div>

    <div id="modal-friend-profile" class="modal-overlay">
        <div class="modal-panel login-box" style="text-align:center;">
            <div id="fp-av"></div>
            <div id="fp-name">...</div>
            <div id="fp-lvl" style="color:var(--accent); font-weight:900;">LVL ...</div>
            <div id="fp-stats">
                <div class="fp-stat-box">SCORE<br><span id="fp-score" style="font-size:1.5rem; color:white;">0</span></div>
                <div class="fp-stat-box">PP<br><span id="fp-pp" style="font-size:1.5rem; color:var(--blue);">0</span></div>
            </div>
             <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin:10px 0;">
                <div class="fp-stat-box" style="background:#222;">RANKED PLAYS<br><span id="fp-plays" style="font-size:1.2rem; color:var(--gold);">0</span></div>
                <div class="fp-stat-box" style="background:#222;">GLOBAL RANK<br><span id="fp-rank" style="font-size:1.2rem; color:white;">#--</span></div>
            </div>

            <div id="fp-status-text" style="color:#888; font-style:italic; margin-bottom:15px;">Desconectado</div>
            <div class="fp-actions">
                <button class="btn-chat" onclick="openFloatingChat()">üí¨ CHATEAR</button>
                <button id="btn-challenge" class="btn-add" disabled>‚öîÔ∏è DESAFIAR (OLD 1v1)</button>
            </div>
            <button class="action secondary" style="margin-top:20px;" onclick="closeModal('friend-profile')">CERRAR</button>
        </div>
    </div>

    <div id="modal-rank" class="modal-overlay">
        <div class="modal-panel">
            <div class="m-title">RANKING GLOBAL</div>
            <table class="rank-table">
                <thead><tr><th>#</th><th>JUGADOR</th><th>PP</th></tr></thead>
                <tbody id="rank-list"></tbody>
            </table>
            <button class="action secondary" style="margin-top:30px;" onclick="closeModal('rank')">CERRAR</button>
        </div>
    </div>

    <div id="modal-profile" class="modal-overlay">
        <div class="modal-panel login-box">
            <div id="login-view">
                <div class="m-title">ACCESO</div>
                <button class="btn-google" onclick="loginGoogle()">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
                    CONTINUAR CON GOOGLE
                </button>
                <div style="margin: 15px 0; color:#666;">--- O USA CUENTA LOCAL ---</div>
                <input type="text" id="l-user" class="log-inp" placeholder="Usuario">
                <input type="password" id="l-pass" class="log-inp" placeholder="Contrase√±a">
                <button class="action" onclick="login()">ENTRAR</button>
                <button class="action secondary" onclick="register()">REGISTRAR</button>
            </div>
            <div id="profile-view" style="display:none;">
                <div class="m-title">TU PERFIL</div>
                
                <div class="settings-tabs">
                    <div class="kb-tab active" id="ptab-resumen" onclick="switchProfileTab('resumen')">RESUMEN</div>
                    <div class="kb-tab" id="ptab-cuenta" onclick="switchProfileTab('cuenta')">CUENTA</div>
                </div>

                <div id="p-tab-content-resumen">
                    <label class="prof-av-big" id="p-av-big" style="z-index: 20;">
                        <input type="file" accept="image/*" style="display:none" onchange="uploadAvatar(this)" onclick="this.value=null">
                    </label>
                    <h2 id="p-name" style="margin:0;">User</h2>
                    <div id="p-lvl-txt" style="color:var(--accent); font-weight:900; font-size:1.4rem;">LVL 1</div>
                    
                    <div class="xp-container"><div class="xp-fill" id="p-xp-bar"></div></div>
                    <div class="xp-text" id="p-xp-txt">0 / 1000 XP</div>

                    <div style="color:var(--blue); font-weight:bold; margin:20px 0; font-size:1.2rem;">GLOBAL RANK: <span id="p-global-rank">#--</span></div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:30px;">
                        <div style="background:#151515; padding:20px; border-radius:12px;">SCORE<br><span id="p-score" style="font-size:1.5rem; color:white;">0</span></div>
                        <div style="background:#151515; padding:20px; border-radius:12px;">JUGADAS<br><span id="p-plays" style="font-size:1.5rem; color:white;">0</span></div>
                        <div style="background:#151515; padding:20px; border-radius:12px;">PP<br><span id="p-pp-display" style="font-size:1.5rem; color:var(--blue);">0</span></div>
                        <div style="background:#151515; padding:20px; border-radius:12px;">SCORE POINTS<br><span id="p-sp-display" style="font-size:1.5rem; color:var(--gold);">0</span></div>
                    </div>
                </div>

                <div id="p-tab-content-cuenta" style="display:none;">
                    <div id="local-acc-settings">
                        <div style="color:#aaa; margin-bottom:15px;">Cambiar Contrase√±a (Solo Cuentas Locales)</div>
                        <input type="password" id="new-pass" class="log-inp" placeholder="Nueva contrase√±a">
                        <button class="action secondary" onclick="changePassword()">ACTUALIZAR CONTRASE√ëA</button>
                    </div>
                    <div id="google-acc-settings" style="display:none; color:#aaa; margin-top:20px;">
                        Tu cuenta est√° vinculada con Google. Gestiona tu seguridad desde tu cuenta de Google.
                    </div>
                     <button class="action secondary" style="border-color:#F9393F; color:#F9393F; margin-top:30px;" onclick="logout()">CERRAR SESI√ìN</button>
                </div>
            </div>
            <button class="action secondary" style="margin-top:20px;" onclick="closeModal('profile')">CERRAR</button>
        </div>
    </div>
    <div id="modal-upload" class="modal-overlay">
        <div class="modal-panel login-box" style="text-align:left;">
            <div class="m-title">SUBIR A LA NUBE</div>
            <div style="color:#aaa; margin-bottom:20px; font-size:0.9rem;">Comparte tu canci√≥n con toda la comunidad.</div>
            
            <div style="margin-bottom:15px;"><label style="font-weight:bold;">1. Audio (MP3/WAV)</label><input type="file" id="up-audio" accept="audio/*" class="log-inp" style="padding:10px;" onchange="autoFillTitle(this)"></div>

    <div id="modal-settings" class="modal-overlay">
        <div class="modal-panel">
            <div class="m-title">CONFIGURACI√ìN</div>
            <div class="set-grid">
                <div>
                    <div class="set-head">GENERAL</div>
                    <div class="set-row"><span>Velocidad (Scroll)</span><input type="range" id="set-spd" min="10" max="40"></div>
                    <div class="set-row"><span>Dificultad (Mapas)</span><input type="range" id="set-den" min="1" max="10"></div>
                    <div class="set-row"><span>Volumen M√∫sica</span><input type="range" id="set-vol" min="0" max="100"></div>
                    <div class="set-row"><span>Volumen Hits</span><input type="range" id="set-hvol" min="0" max="100"></div>
                    <div class="set-row"><span>Downscroll</span><input type="checkbox" id="set-down"></div>
                    <div class="set-row"><span>Efectos (Vivid)</span><input type="checkbox" id="set-vivid"></div>
                    <div class="set-row"><span>Shake (Impacto)</span><input type="checkbox" id="set-shake"></div>
                    
                    <div class="set-row"><span>Offset (ms)</span><input type="number" id="set-off" style="width:70px; background:#111; border:1px solid #444; color:white; padding:5px; text-align:center;"></div>
                    
                    <div class="set-head" style="margin-top:30px;">HUD PERSONALIZADO</div>
                    <div class="set-row"><span>Opacidad Carril</span><input type="range" id="set-track-op" min="0" max="100"></div>
                    <div class="set-row"><span>Posici√≥n Juez (Y)</span><input type="range" id="set-judge-y" min="10" max="90"></div>
                    <div class="set-row"><span>Posici√≥n Juez (X)</span><input type="range" id="set-judge-x" min="10" max="90"></div>
                    <div class="set-row"><span>Tama√±o Juez</span><input type="range" id="set-judge-s" min="5" max="20"></div>
                    <div class="set-row"><span>Mostrar Juez</span><input type="checkbox" id="set-judge-vis" checked></div>
            <div style="margin-bottom:15px;"><label style="font-weight:bold;">2. T√≠tulo (Editable)</label><input type="text" id="up-title" class="log-inp" style="text-align:left;"></div>

                    <button class="action secondary" style="margin-top:15px; font-size:1rem;" onclick="document.getElementById('bg-file').click()">üñºÔ∏è CAMBIAR FONDO</button>
                    <input type="file" id="bg-file" accept="image/*" style="display:none" onchange="handleBg(this)" onclick="this.value=null">
                </div>
                <div>
                    <div class="set-head">CONTROLES & COLORES</div>
                    <div class="kb-tabs">
                        <div class="kb-tab active" id="tab-4" onclick="renderLaneConfig(4)">4K</div>
                        <div class="kb-tab" id="tab-6" onclick="renderLaneConfig(6)">6K</div>
                        <div class="kb-tab" id="tab-7" onclick="renderLaneConfig(7)">7K</div>
                        <div class="kb-tab" id="tab-9" onclick="renderLaneConfig(9)">9K</div>
                    </div>
                    <div class="lane-cfg-box">
                        <div id="lanes-container" class="lanes-view"></div>
                        <div style="font-size:0.9rem; color:#666; margin-top:25px;">
                            Click en tecla para cambiar | Click en forma para rotar
                        </div>
                    </div>
                    
                    <button class="action secondary" style="margin-top:30px; font-size:1rem;" onclick="document.getElementById('hit-file').click()">üîä CUSTOM HIT SOUND</button>
                    <input type="file" id="hit-file" accept="audio/*" style="display:none" onchange="loadHitSound(this)" onclick="this.value=null">
                </div>
            </div>
            <button class="action" onclick="saveSettings()">GUARDAR</button>
            <div style="margin-bottom:20px;"><label style="font-weight:bold;">3. Portada (Opcional - JPG/PNG)</label><input type="file" id="up-image" accept="image/*" class="log-inp" style="padding:10px;"></div>
            
            <div id="upload-status" style="text-align:center; color:var(--accent); font-weight:bold; margin-bottom:10px;"></div>
            <button class="action" onclick="startGlobalUpload()" id="btn-upload-start">‚òÅÔ∏è PUBLICAR</button>
            <button class="action secondary" onclick="closeModal('upload')">CANCELAR</button>
        </div>
    </div>

    <div id="modal-diff" class="modal-overlay">
        <div class="modal-panel" style="width:850px;">
            <div class="m-title">SELECCIONA MODO</div>
            <div id="diff-song-cover" style="width:250px; height:250px; background:#333; margin:0 auto 20px; border-radius:15px; background-size:cover; background-position:center; border:3px solid var(--accent); box-shadow:0 0 40px rgba(255,102,170,0.2);"></div>
            <div id="diff-song-title" style="text-align:center; font-size:2rem; font-weight:900; margin-bottom:30px; color:white;">...</div>
            <div class="diff-grid">
                <div class="diff-card" onclick="startGame(4)" style="color:#00FFFF"><div style="font-size:3rem;font-weight:900">4K</div>NORMAL</div>
                <div class="diff-card" onclick="startGame(6)" style="color:#12FA05"><div style="font-size:3rem;font-weight:900">6K</div>HARD</div>
                <div class="diff-card" onclick="startGame(7)" style="color:#FFD700"><div style="font-size:3rem;font-weight:900">7K</div>INSANE</div>
                <div class="diff-card" onclick="startGame(9)" style="color:#F9393F"><div style="font-size:3rem;font-weight:900">9K</div>DEMON</div>
            </div>
            
            <div class="ranked-toggle">
                <input type="checkbox" id="chk-ranked">
                <label for="chk-ranked" style="margin-left:10px; color:var(--accent);">RANKED MODE (GANA PP)</label>
            </div>
            
            <div id="create-lobby-opts" style="display:none; margin-top:20px;">
                <button class="action" onclick="confirmCreateLobby()">CREAR SALA</button>
            </div>

            <div class="ranked-toggle"><input type="checkbox" id="chk-ranked"><label for="chk-ranked" style="margin-left:10px; color:var(--accent);">RANKED MODE (GANA PP)</label></div>
            <div id="create-lobby-opts" style="display:none; margin-top:20px;"><button class="action" onclick="confirmCreateLobby()">CONFIRMAR SALA</button></div>
            <button class="action secondary" style="margin-top:20px;" onclick="closeModal('diff')">CANCELAR</button>
        </div>
    </div>

    <div id="modal-pause" class="modal-overlay">
        <div class="modal-panel login-box">
            <div class="m-title">PAUSA</div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:30px; font-size:1.3rem;">
                <div style="color:var(--sick)">SICK: <span id="p-sick">0</span></div>
                <div style="color:var(--good)">GOOD: <span id="p-good">0</span></div>
                <div style="color:var(--bad)">BAD: <span id="p-bad">0</span></div>
                <div style="color:var(--miss)">MISS: <span id="p-miss">0</span></div>
            </div>
            <button class="action" onclick="resumeGame()">CONTINUAR</button>
            <button class="action secondary" onclick="toMenu()">SALIR AL MENU</button>
        </div>
    </div>

    <div id="modal-res" class="modal-overlay">
        <div class="modal-panel login-box" style="width:600px;">
            <div class="m-title">RESULTADOS</div>
            <div class="res-rank" id="res-rank">S</div>
            <div id="winner-msg" style="font-size:2rem; font-weight:900; color:var(--sick); margin-bottom:20px; display:none;">¬°GANASTE!</div>
            <div style="font-size:4rem; font-weight:900;" id="res-score">0</div>
            <div style="color:#aaa; font-size:1.5rem;">ACCURACY: <span id="res-acc" style="color:white; font-weight:bold;">100%</span></div>
            <div id="pp-gain-loss" style="color:var(--gold); font-weight:bold; margin-top:15px; font-size:1.2rem;">+0 PP</div>
            <div style="display:flex; justify-content:space-around; margin-top:15px; font-weight:bold;">
                <div style="color:var(--blue); font-size:1rem;">+<span id="res-xp">0</span> XP</div>
                <div style="color:var(--gold); font-size:1rem;">+<span id="res-sp">0</span> SP</div>
            </div>
            <button class="action" onclick="toMenu()">VOLVER</button>
        </div>
    </div>
    <div id="modal-news" class="modal-overlay"> <div class="modal-panel"> <div class="m-title">NOVEDADES</div> <ul><li>Subida de canciones simplificada.</li><li>Imagen de portada opcional.</li></ul> <button class="action secondary" onclick="closeModal('news')">CERRAR</button> </div> </div>
    <div id="modal-shop" class="modal-overlay"> <div class="modal-panel"> <div class="m-title">TIENDA (SP)</div> <div style="text-align:center;">Puntos: <span id="shop-sp">0</span> SP</div><div class="shop-grid" id="shop-items"></div> <button class="action secondary" onclick="closeModal('shop')">CERRAR</button> </div> </div>
    <div id="modal-lobbies" class="modal-overlay"> <div class="modal-panel"> <div class="m-title">SALAS</div> <div id="lobby-list"></div> <div style="display:flex; gap:10px;"><button class="action" onclick="openSongSelectorForLobby()">CREAR SALA</button><button class="action secondary" onclick="refreshLobbies()">ACTUALIZAR</button></div><button class="action secondary" onclick="closeModal('lobbies')">CERRAR</button> </div> </div>
    <div id="modal-lobby-room" class="modal-overlay"> <div class="modal-panel"> <div class="m-title" id="room-host-name">SALA</div> <div id="room-song"></div> <div id="room-players"></div> <button class="action" onclick="toggleReady()">LISTO</button> <button class="action secondary" onclick="leaveLobby()">SALIR</button> </div> </div>
    <div id="modal-friends" class="modal-overlay"> <div class="modal-panel"> <div class="m-title">AMIGOS</div> <input id="friend-inp" class="log-inp"><button class="action" onclick="sendFriendRequest()">AGREGAR</button> <div id="friend-list"></div> <button class="action secondary" onclick="closeModal('friends')">CERRAR</button> </div> </div>
    <div id="modal-friend-profile" class="modal-overlay"> <div class="modal-panel login-box"> <div id="fp-av" class="prof-av-big"></div> <div id="fp-name"></div> <div id="fp-lvl"></div> <div id="fp-stats" style="display:flex;gap:10px;"><div class="fp-stat-box">SCORE<br><span id="fp-score"></span></div><div class="fp-stat-box">PP<br><span id="fp-pp"></span></div></div> <div id="fp-plays"></div><div id="fp-rank"></div> <div id="fp-status-text"></div> <div class="fp-actions"><button class="btn-chat" onclick="openFloatingChat()">CHAT</button><button id="btn-challenge">DESAFIAR</button></div> <button class="action secondary" onclick="closeModal('friend-profile')">CERRAR</button> </div> </div>
    <div id="modal-rank" class="modal-overlay"> <div class="modal-panel"> <div class="m-title">RANKING</div> <table class="rank-table"><tbody id="rank-list"></tbody></table> <button class="action secondary" onclick="closeModal('rank')">CERRAR</button> </div> </div>
    <div id="modal-profile" class="modal-overlay"> <div class="modal-panel login-box"> <div id="login-view"> <button class="btn-google" onclick="loginGoogle()">GOOGLE</button> <input id="l-user" class="log-inp"><input id="l-pass" type="password" class="log-inp"> <button class="action" onclick="login()">ENTRAR</button><button class="action secondary" onclick="register()">REGISTRAR</button> </div> <div id="profile-view"> <div class="settings-tabs"><div id="ptab-resumen" class="kb-tab active" onclick="switchProfileTab('resumen')">RESUMEN</div><div id="ptab-cuenta" class="kb-tab" onclick="switchProfileTab('cuenta')">CUENTA</div></div> <div id="p-tab-content-resumen"> <label id="p-av-big" class="prof-av-big"><input type="file" onchange="uploadAvatar(this)" style="display:none"></label> <div id="p-name"></div> <div id="p-lvl-txt"></div> <div class="xp-container"><div id="p-xp-bar" class="xp-fill"></div></div> <div id="p-xp-txt"></div> <div id="p-global-rank"></div> <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;"><div class="fp-stat-box">SCORE<br><span id="p-score"></span></div><div class="fp-stat-box">PLAYS<br><span id="p-plays"></span></div><div class="fp-stat-box">PP<br><span id="p-pp-display"></span></div><div class="fp-stat-box">SP<br><span id="p-sp-display"></span></div></div> </div> <div id="p-tab-content-cuenta" style="display:none;"> <div id="local-acc-settings"><input id="new-pass" type="password" class="log-inp"><button class="action" onclick="changePassword()">CAMBIAR PASS</button></div> <div id="google-acc-settings">Cuenta Google</div> <button class="action secondary" onclick="logout()">LOGOUT</button> </div> </div> <button class="action secondary" onclick="closeModal('profile')">CERRAR</button> </div> </div>
    <div id="modal-settings" class="modal-overlay"> <div class="modal-panel"> <div class="m-title">AJUSTES</div> <div class="set-grid"> <div> <div class="set-row">SPD<input type="range" id="set-spd" min="10" max="40"></div> <div class="set-row">DEN<input type="range" id="set-den" min="1" max="10"></div> <div class="set-row">VOL<input type="range" id="set-vol"></div> <div class="set-row">HVOL<input type="range" id="set-hvol"></div> <div class="set-row">DOWN<input type="checkbox" id="set-down"></div> <div class="set-row">VIVID<input type="checkbox" id="set-vivid"></div> <div class="set-row">SHAKE<input type="checkbox" id="set-shake"></div> <div class="set-row">OFF<input type="number" id="set-off"></div> <div class="set-row">TRK OP<input type="range" id="set-track-op"></div> <div class="set-row">JY<input type="range" id="set-judge-y"></div> <div class="set-row">JX<input type="range" id="set-judge-x"></div> <div class="set-row">JS<input type="range" id="set-judge-s"></div> <div class="set-row">JVIS<input type="checkbox" id="set-judge-vis"></div> <button class="action secondary" onclick="document.getElementById('bg-file').click()">BG</button><input type="file" id="bg-file" onchange="handleBg(this)" style="display:none"> </div> <div> <div class="kb-tabs"><div id="tab-4" class="kb-tab" onclick="renderLaneConfig(4)">4K</div><div id="tab-6" class="kb-tab" onclick="renderLaneConfig(6)">6K</div><div id="tab-7" class="kb-tab" onclick="renderLaneConfig(7)">7K</div><div id="tab-9" class="kb-tab" onclick="renderLaneConfig(9)">9K</div></div> <div id="lanes-container" class="lanes-view"></div> <button class="action secondary" onclick="document.getElementById('hit-file').click()">HIT SOUND</button><input type="file" id="hit-file" onchange="loadHitSound(this)" style="display:none"> </div> </div> <button class="action" onclick="saveSettings()">GUARDAR</button> </div> </div>
    <div id="modal-pause" class="modal-overlay"> <div class="modal-panel login-box"> <div class="m-title">PAUSA</div> <div style="display:grid;grid-template-columns:1fr 1fr;"><div>S:<span id="p-sick"></span></div><div>G:<span id="p-good"></span></div><div>B:<span id="p-bad"></span></div><div>M:<span id="p-miss"></span></div></div> <button class="action" onclick="resumeGame()">CONTINUAR</button> <button class="action secondary" onclick="toMenu()">SALIR</button> </div> </div>
    <div id="modal-res" class="modal-overlay"> <div class="modal-panel login-box"> <div class="m-title">RESULTADOS</div> <div id="res-rank" class="res-rank"></div> <div id="winner-msg"></div> <div id="res-score" style="font-size:3rem;"></div> <div>ACC:<span id="res-acc"></span></div> <div id="pp-gain-loss"></div> <div>+<span id="res-xp"></span> XP | +<span id="res-sp"></span> SP</div> <button class="action" onclick="toMenu()">VOLVER</button> </div> </div>

    <script src="js/globals.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/online.js"></script>
    <script src="js/game.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
